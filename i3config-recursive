# vim: filetype=config fdm=marker sw=4 ts=4 commentstring=#\ %s

# Modifiers {{{
set $shift Shift
set $ctrl Control
set $meta Mod4
set $alt Mod1
# }}}

# Direction keys {{{
set $up k
set $down j
set $left h
set $right l
# }}}

# Colors {{{
# class                 border  backgr. text    indicator child_border
# client.focused        #4c7899 #285577 #ffffff #2e9ef4   #285577
client.focused          #00ff00 #007000 #ffffff #ffff00   #007000
# client.focused          #ee4400 #ff0000 #ffffff #ffff00   #ff0000
client.focused_inactive #333333 #5f676a #ffffff #484e50   #5f676a
client.unfocused        #333333 #222222 #888888 #292d2e   #222222
client.urgent           #2f343a #900000 #ffffff #900000   #900000
client.placeholder      #000000 #0c0c0c #ffffff #000000   #0c0c0c
client.background       #ffffff
# }}}

# Font {{{
set $font "pango:DejaVu Sans Mono 9"
# set $font "pango:DejaVu Sans Mono 100"
# set $font pango:monospace 10
# set $font -misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1
# set $font pango:Noto Sans Mono 10
font $font
# set $i3input i3-input -f "$font"
# TODO: make eval on right side of set work
set $i3input i3-input -f "pango:DejaVu Sans Mono 10"
# set $i3input i3-input -f "pango:DejaVu Sans Mono 50"
# }}}

# Default applications {{{
set $browser google-chrome-stable
set $terminal kitty -o allow_remote_control=socket-only --listen-on unix:/tmp/kittyctrl --single-instance
set $terminal_tmux kitty -o allow_remote_control=socket-only --listen-on unix:/tmp/kittyctrl --single-instance zsh -ic 'tmm'
set $lock_now ~/bin/i3lock-wrapper.sh
# }}}

# Options {{{
for_window [class="scrcpy"] move left, resize shrink width 700
# for_window [class="scrcpy"] resize set 40 0
# for_window [class="Arandr"] floating enable, resize set 400 400

for_window [class="XEyes"] floating enable, border none
# for_window [class="XEyes"] floating enable, resize set 350 200, border none
for_window [class="Pavucontrol"] floating enable, resize set 600 750
# for_window [class="Pidgin" window_role="buddy_list"] floating enable, resize set 540 260
for_window [class="jetbrains-studio" title="Breakpoints"] floating disable
for_window [class="jetbrains-studio" title="Change Signature"] floating disable
for_window [class="jetbrains-studio" title="Settings"] floating disable
# WM_NAME(STRING) = "Breakpoints" WM_CLASS(STRING) = "jetbrains-studio", "jetbrains-studio" 
for_window [class="copyq" floating] floating disable
# assign [class="copyq"] $WS_LOG
# for_window [con_mark=""] title_format "T: <b>%title</b> (%class - %instance)"
hide_edge_borders none
floating_minimum_size 200 x 200
floating_modifier $alt
focus_follows_mouse yes
focus_wrapping yes # focus_wrapping force
force_display_urgency_hint 666 ms
no_focus [window_role="pop-up"]
popup_during_fullscreen leave_fullscreen # ignore, smart
show_marks yes
workspace_auto_back_and_forth yes
workspace_layout default # default, stacking, tabbed
# }}}

# Key bindings {{{

set $mode_i3 "[i3: b:border h:hide, i:float, m:scratchpad, r:rename ws, s:toggle bar, t:tag, y:sticky]"
set $mode_move "[move: hjkl]"
set $mode_resize "[resize: hjkl+shift/ctrl]"
set $mode_manipulate "[manipulate: hjkl+shift/ctrl]"
set $mode_system "[system: l:lock, s:suspend, S:lock&suspend, h:hibernate]"
set $mode_wallpaper "[walpaper: n:next, p:previous, d:disable, e:enable, f:favorite]"
set $mode_return mode "default"
set $step_size 20 px

# Mode "i3" {{{
set $mode_i3_key u
bindsym $meta+$mode_i3_key mode $mode_i3
mode $mode_i3 {
	bindsym $shift+h move window to workspace "new", $mode_return
	bindsym a exec xrandr --output eDP-1 --primary --auto --output HDMI-1 --off --output HDMI-2 --off --output DP-1-1 --off --output DP-1-2 --off --output DP-1-3 --off --output DP-2-1 --off --output DP-2-2 --off --output DP-2-3 --off, exec i3-ws-primary, $mode_return
	# bindsym x exec xrandr --output eDP-1 --off --output DP-2-1 --auto --primary --right-of eDP-1, $mode_return
	bindsym x exec xrandr --output eDP-1 --off --output DP-1-1 --auto --primary, $mode_return
	bindsym x exec xrandr --output eDP-1 --auto --output DP-1-1 --auto --primary --right-of eDP-1, $mode_return
	bindsym c exec autorandr --change, $mode_return
	bindsym $shift+x exec i3-ws-primary, $mode_return
	bindsym b border toggle
	bindsym h move scratchpad, $mode_return
	bindsym i floating toggle, $mode_return
	bindsym m scratchpad show, $mode_return
	bindsym n move window to workspace "new", exec i3-ws-enum, $mode_return
	bindsym r exec $i3input -F 'rename workspace to "%s"' -P 'Rename workspace: ', $mode_return
	bindsym $shift+r exec reload, $mode_return
	bindsym 0x2c exec $i3input -F 'rename workspace to "%s"' -P 'Rename workspace: ', $mode_return
	bindsym s bar mode toggle, $mode_return
	bindsym t exec $i3input -F 'mark "%s"' -P 'tag: ', $mode_return
	bindsym v split toggle
	bindsym y sticky toggle, $mode_return

	# bindsym $meta+u exec i3 workspace $(2> /dev/null shuf -n 1 /usr/share/dict/words || date '+%s'),  exec $browser, exec i3-ws-enum,
	bindsym $meta+u exec notify-send "i3: Entering recursive mode", exec ln -sf ~/.dotfiles/i3config-recursive ~/.config/i3/config, reload, $mode_return
	bindsym o exec notify-send "i3: Leaving recursive mode", exec ln -sf ~/.dotfiles/i3config-full ~/.config/i3/config, reload, $mode_return
	
	# TODO: Make the following binding work
	# bindsym "," exec $i3input -F 'rename workspace to "%s"' -P 'Rename workspace: ', $mode_return
	# bindsym n exec $i3input -F 'move container to workspace %s' -P 'Move container to new workspace: ', $mode_return
	bindsym n exec i3-ws-move, $mode_return
	bindsym $shift+n exec i3-ws-move -f, $mode_return

	# Exit mode
	bindsym $ctrl+c $mode_return
	bindsym $ctrl+0x5b $mode_return
	bindsym Return $mode_return
	bindsym Escape $mode_return
	bindsym $meta+$mode_i3_key $mode_return
}
# }}}

# Mode "move" {{{
bindsym $meta+m mode $mode_move
mode $mode_move {
	bindsym $left move left
	bindsym $up move up
	bindsym $down move down
	bindsym $right move right
	bindsym $shift+$left move left 80
	bindsym $shift+$up move up 80
	bindsym $shift+$down move down 80
	bindsym $shift+$right move right 80
	# TODO: add shift mod to move faster (i.e. more pixels)

	# Exit mode
	bindsym $ctrl+c $mode_return
	bindsym $ctrl+0x5b $mode_return
	bindsym Return $mode_return
	bindsym Escape $mode_return
	bindsym $meta+m $mode_return
	bindsym $meta+r mode $mode_resize
	bindsym r mode $mode_resize
	bindsym $meta+$shift+m mode $mode_manipulate
	bindsym $shift+m mode $mode_manipulate
	bindsym m mode $mode_manipulate
}
# }}}

# Mode "resize" {{{
bindsym $meta+r mode $mode_resize
mode $mode_resize {
	# bindsym $right resize shrink width $step_size
	bindsym $left resize shrink width $step_size
	bindsym $right resize grow width $step_size
	bindsym $up resize shrink height $step_size
	bindsym $down resize grow height $step_size

	bindsym $ctrl+$left resize shrink width $step_size; resize shrink height $step_size
	bindsym $ctrl+$right resize grow width $step_size; resize grow height $step_size
	bindsym $ctrl+$up resize shrink width $step_size; resize shrink height $step_size
	bindsym $ctrl+$down resize grow height $step_size; resize grow width $step_size

	bindsym shift+$left move left $step_size
	bindsym shift+$up move up $step_size
	bindsym shift+$down move down $step_size
	bindsym shift+$right move right $step_size

	# Exit mode
	bindsym $ctrl+c $mode_return
	bindsym $ctrl+0x5b $mode_return
	bindsym Return $mode_return
	bindsym Escape $mode_return
	bindsym $meta+r $mode_return
	bindsym $meta+m mode $mode_move
	bindsym m mode $mode_move
	bindsym r mode $mode_move
	bindsym $meta+shift+m mode $mode_manipulate
}
# }}}

# Mode "manipulate" {{{
bindsym $meta+shift+m mode $mode_manipulate
mode $mode_manipulate {
	bindsym $left resize shrink width $step_size
	bindsym $up resize shrink height $step_size
	bindsym $down resize grow height $step_size
	bindsym $right resize grow width $step_size

	bindsym $ctrl+$left resize shrink width $step_size; resize shrink height $step_size
	bindsym $ctrl+$right resize grow width $step_size; resize grow height $step_size
	bindsym $ctrl+$up resize shrink width $step_size; resize shrink height $step_size
	bindsym $ctrl+$down resize grow height $step_size; resize grow width $step_size

	bindsym shift+$left move left $step_size
	bindsym shift+$up move up $step_size
	bindsym shift+$down move down $step_size
	bindsym shift+$right move right $step_size

	bindsym 1 resize set 250 0
	bindsym 2 resize set 500 0
	bindsym 3 resize set 50ppt 0
	bindsym 4 resize set 60ppt 0
	bindsym 9 resize set 30ppt 0
	bindsym 0 resize set 90ppt 0
	bindsym i floating toggle

	# Exit mode
	bindsym $ctrl+c $mode_return
	bindsym $ctrl+0x5b $mode_return
	bindsym Return $mode_return
	bindsym Escape $mode_return
	bindsym $meta+shift+m $mode_return
	bindsym $meta+r mode $mode_resize
	bindsym k mode $mode_resize
	bindsym $meta+m mode $mode_move
	bindsym m mode $mode_move
}
# }}}

# Mode "system" {{{
bindsym $meta+o mode $mode_system
mode $mode_system {
	bindsym l exec $lock_now, $mode_return
	bindsym s exec sus, $mode_return
	bindsym $shift+l exec $lock_now && sleep 0.1 && sus, $mode_return
	bindsym o exec $lock_now && sleep 0.1 && sus, $mode_return
	bindsym $meta+o exec notify-send "i3: Leaving recursive mode", exec ln -sf ~/.dotfiles/i3config-full ~/.config/i3/config, reload, reload $mode_return
	bindsym $shift+s exec $lock_now && sleep 0.1 && sus, $mode_return
	bindsym h exec $lock_now && sleep 0.1 && hib, $mode_return
	bindsym $shift+h exec $lock_now && sleep 0.1 && hib, $mode_return

	# Exit mode
	bindsym $ctrl+c $mode_return
	bindsym $ctrl+0x5b $mode_return
	bindsym Return $mode_return
	bindsym Escape $mode_return
	bindsym $meta+f $mode_return
	bindsym $meta+o $mode_return
}
# }}}

# Mode "wallpaper"  {{{
bindsym $meta+p mode $mode_wallpaper
mode $mode_wallpaper {
	bindsym n workspace --no-auto-back-and-forth desktop, exec variety --next
	bindsym p exec variety --previous
	bindsym f exec variety --favorite, $mode_return
	# bindsym $shift+P exec variety --show-preferences, $mode_return
	bindsym d exec variety --quit, exec xsetroot -solid black, exec rm -f /tmp/i3lock.png, $mode_return
	bindsym e exec variety, exec xsetroot -solid black, $mode_return
	bindsym c exec variety --current | tr -d \n | xclip, $mode_return

	# Exit mode
	bindsym $ctrl+c $mode_return
	bindsym $ctrl+0x5b $mode_return
	bindsym Return $mode_return
	bindsym Escape $mode_return
	bindsym $meta+f $mode_return
	bindsym $meta+o $mode_return
}
# }}}

# }}}
# }}}

# Mouse bindings {{{
bindsym --release --whole-window $meta+button1 floating toggle
bindsym --release --whole-window $meta+button2 kill
bindsym --release button2 kill
bindsym button3 floating toggle
bindsym button4 resize shrink width $step_size
bindsym button5 resize grow width $step_size
bindsym $shift+button4 resize shrink height $step_size
bindsym $shift+button5 resize grow height $step_size
# bindsym $alt+$shift+button4 resize shrinkg height $step_size, resize shrink height $step_size
# bindsym $alt+$shift+button5 resize grow height $step_size, resize grow height $step_size

bindsym --whole-window $alt+button4 resize shrink height $step_size, resize shrink width $step_size
bindsym --whole-window $ctrl+$alt+button4 resize shrink height $step_size
bindsym --whole-window $shift+$alt+button4 resize shrink width $step_size
bindsym --whole-window $alt+button5 resize grow height $step_size, resize grow width $step_size
bindsym --whole-window $ctrl+$alt+button5 resize grow height $step_size
bindsym --whole-window $shift+$alt+button5 resize grow width $step_size

# The side buttons move the window around
bindsym button8 move right
bindsym button9 move left

# bindsym --whole-window $mod+button1 move right
# }}}

# Bars {{{
bar {
	position top
	font $font
	status_command ~/bin/i3status_wrapper
	tray_output primary
	tray_padding 3 px
	separator_symbol "|"
	strip_workspace_numbers no
	strip_workspace_name no
	binding_mode_indicator yes
	workspace_buttons yes
	# mode dock
	# hidden_state show
	colors {
		background #000000
		statusline #ffffff
		separator #709099

		focused_workspace  #4c7899 #007000 #ffffff
		active_workspace   #555555 #5f676a #ffffff
		inactive_workspace #333333 #222222 #888888
		urgent_workspace   #2f343a #900000 #ffffff
		binding_mode       #2f343a #909000 #ffffff
	}
}
# }}}

# Default workspaces {{{

# WS_LOG {{{
set $WS_LOG "0:log"
# assign [class="copyq"] $WS_LOG
exec --no-startup-id i3-msg 'workspace $WS_LOG; exec $terminal_tmux'
# }}}

# WS_COMS {{{
set $WS_COMS "1:coms"
exec --no-startup-id i3-msg 'workspace $WS_COMS; exec $terminal_tmux'
assign [class="Google-chrome" title="Telegram Web - Google Chrome"] $WS_COMS
assign [class="Signal" ] $WS_COMS
assign [instance="crx_nckgahadagoaajjgafhacjanaoiihapd"] $WS_COMS
assign [class="Pidgin"] $WS_COMS
# }}}

# # WS_ROOT {{{
# set $WS_ROOT "2:root"
# exec --no-startup-id i3-msg 'workspace $WS_ROOT; exec $terminal_tmux'
# # exec --no-startup-id i3-msg 'workspace $WS_ROOT; exec $browser'
# # }}}

# WS_NGEN {{{
set $WS_NGEN "2:ngen"
exec --no-startup-id i3-msg 'workspace $WS_NGEN; exec $terminal_tmux'
# exec --no-startup-id i3-msg 'workspace $WS_NGEN; exec $browser'
# }}}

# WS_UML {{{
set $WS_UML "3:UML"
# exec --no-startup-id i3-msg 'workspace $WS_UML; exec $terminal_tmux'
exec --no-startup-id i3-msg 'workspace $WS_UML; exec $browser'
# }}}

# WS_WWW {{{
set $WS_WWW "4:www"
exec --no-startup-id i3-msg 'workspace $WS_WWW; exec $terminal_tmux'
exec --no-startup-id i3-msg 'workspace $WS_WWW; exec $browser'
# }}}

# WS_TV {{{
set $WS_TV "5:TV"
exec --no-startup-id i3-msg 'workspace $WS_TV; exec $terminal_tmux'
exec --no-startup-id i3-msg 'workspace $WS_TV; exec $browser'
# }}}

# WS_QEMU {{{
set $WS_QEMU "qemu"
assign [class="qemu-system-x86_64"] $WS_QEMU
assign [title="Emulator"] $WS_QEMU
# for_window [title="Emulator"] floating enable 
for_window [title="Emulator"] floating disable 
# }}}
# }}}

# Autostart {{{
exec_always --no-startup-id xset -b -c r rate 200 140 dpms 0 0 2400 s off
exec_always --no-startup-id setxkbmap -layout us,de -option grp:alt_caps_toggle
exec_always --no-startup-id xmodmap -e "keycode 94 = asciitilde asciitilde asciitilde asciitilde"
# exec_always --no-startup-id systemctl is-active --user --quiet dunst.service || dunst
bindsym $ctrl+$shift+space exec dunstctl close
bindsym $ctrl+$shift+1 exec dunstpaused
bindsym $ctrl+$shift+2 exec dunstpause
bindsym $ctrl+$shift+3 exec dunstctl history-pop
# xautolock's hotcorner seem to get confused when switching monitor setup
# exec_always --no-startup-id xautolock -time 9 -corners '--++' -cornerdelay 1 -cornerredelay 60 -locker i3lock-wrapper.sh -detectsleep
exec_always --no-startup-id nm-applet
exec_always --no-startup-id pa-applet
exec_always --no-startup-id killall unclutter ; unclutter --ignore-scrolling --fork --timeout 5
exec_always --no-startup-id copyq
# exec_always --no-startup-id firewall-applet
exec_always --no-startup-id xsetroot -solid black
# exec_always --no-startup-id variety --next
# exec_always --no-startup-id blueman-tray
exec_always --no-startup-id blueman-applet
exec_always --no-startup-id pgrep -x firewall-applet || firewall-applet
exec_always --no-startup-id xsetroot -solid black
# exec_always --no-startup-id variety --next
exec_always --no-startup-id blueman-tray
exec_always --no-startup-id notify-send "i3config loaded."
# }}}
