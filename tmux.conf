set -g prefix C-u
set -g mouse on
set -g mode-keys vi
set -g escape-time 0
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g automatic-rename on
set -g allow-rename on
set -g wrap-search off
set -g history-file ~/.tmux_history
set -g display-panes-time 2222
set -g display-time 2222
set -g history-limit 234545
set -g aggressive-resize on
set -g focus-events on
set -g remain-on-exit off

# Window status line
set -g status on
#set -g status-right 'TODO=#(/Users/dsh0/bin/posteingang_papier_count.sh) #[fg=red]%a %Y-%m-%d %H:%M'
#set -g status-right '#[fg=white]#{pane_tty}(#{pane_id}):#[fg=default]#{pane_current_command} in #{pane_current_path} #[fg=grey]#(sysctl -n vm.loadavg) #[fg=red]%a %Y-%m-%d %H:%M'
#set -g status-right '#[fg=white]#{pane_tty}(#{pane_id}):#[fg=default]#{pane_current_command} #(sysctl -n vm.loadavg) #[fg=red]%a %Y-%m-%d %H:%M'
#set -g status-right '#[fg=red]%a %Y-%m-%d %H:%M'
# set -g status-right '#[fg=red]%a %Y-%m-%d %H:%M:%S'
set -g status-right '#[fg=red]%a %Y-%m-%d %H:%M'
set -g status-right-length 75
set -g status-left-length 16
set -g status-keys vi
set -g status-position bottom
set -g window-status-current-format '#[fg=red]#[bg=yellow]#{?window_zoomed_flag,Z,}#[bg=default]#I#[fg=black]#[bg=red]#W'
set -g window-status-format '#{?window_zoomed_flag,Z,}#[fg=red]#I#[fg=default]#W'

# Pane status line
# set -g  pane-border-format '#{pane_id}: #{pane_tty}(#{pane_width}x#{pane_height}): #{pane_current_command}(#{pane_pid}) #{pane_current_path} '
run-shell -b tmux-pane-format.sh 

# Key bindings
bind -n M-j select-pane -D
bind -T copy-mode-vi M-j select-pane -D
bind -n M-k select-pane -U
bind -T copy-mode-vi M-k select-pane -U
bind -n M-h select-pane -L
bind -T copy-mode-vi M-h select-pane -L
bind -n M-l select-pane -R
bind -T copy-mode-vi M-l select-pane -R
bind -r M-j resize-pane -D 5
bind -n M-J resize-pane -D 5
bind -r M-k resize-pane -U 5
bind -n M-K resize-pane -U 5
bind -r M-h resize-pane -L 5
# bind -n M-H resize-pane -L 5
bind -r M-l resize-pane -R 5
bind -n M-L resize-pane -R 5
bind -n M-p copy-mode
bind -T copy-mode-vi J send-keys -X page-up
bind -T copy-mode-vi K send-keys -X page-down
bind -T copy-mode-vi C-b send-keys -X page-up
bind -T copy-mode-vi C-f send-keys -X page-down
bind -n M-P paste-buffer
bind -n M-w new-window -n "choose-pane" '$SHELL -ic "ftpane"'
#bind -n M-u capture-pane \; save-buffer /tmp/tmux-buffer \; new-window -n "urlview" '$SHELL -c "urlview < /tmp/tmux-buffer"'
bind -n M-n new-window
bind -n M-O new-session
bind -n M-z resize-pane -Z
#bind -t M-m command-prompt -p "Swap this window with window:"  "swap-window -t '%%'"
bind < swap-window -t -1
bind > swap-window -t +1
bind { swap-pane
bind r source ~/.tmux.conf \; display-message ".tmux.conf reloaded."
bind R refresh-client \; display-message "tmux-client refreshed."
bind o command-prompt -p "Name of new session:" 'new-session -s "%%"'
bind M command-prompt -p "Name of new session to move window to:" 'new-session -A -s "%1"\; move-window -t "%1:" \; switch-client -t "%1" bind K kill-session; attach-session'
bind j choose-window "join-pane -v -s '%%'"
bind J choose-window "join-pane -h -s '%%'"
# TODO: Does not switch to target session. :(
bind m choose-session 'move-window -t "%1:" \; switch-client -t "%1" \; display-message "target session = %1"'
bind l choose-session 'link-window -t '%%''
bind L unlink-window 
bind e setw synchronize-panes off
bind C-i confirm-before -p "kill-pane '#W' (#{pane_tty})? (y/n)" kill-pane
bind X confirm-before -p "kill-WINDOW '#W' (#{pane_tty})? (y/n)" kill-window
bind C-p set-window-option pane-border-status
bind C-s set-window-option status
# TODO: Make f search only current pane
bind C-f new-window -n "fzf-pane" '$SHELL -ic "tmux-fzf-panes.sh"'
bind C-F new-window -n "fzf-all-panes" '$SHELL -ic "tmux-fzf-panes.sh"'
# bind C-f run-shell "~/bin/tmux-fzf-panes.sh"
bind C-c run-shell -b tmux-random-background-color.sh
bind c select-pane -P default
bind x run-shell tmux-cross-over.sh
bind = choose-buffer
# TODO: finish script
# bind = new-window -n "choose-pane" '$SHELL -ic "~/bin/tmux-select-buffer.sh"'
bind r source ~/.tmux.conf \; display-message ".tmux.conf reloaded."
bind m select-pane -m

bind -n M-1 previous-window
bind -n M-2 next-window
bind -n M-3 last-window
bind -n M-4 last-pane
bind -n M-q last-pane
bind -n M-5 switch-client -l
# Add colors to choose-tree - FIXME: Does not work :(
# bind -n M-0 choose-tree -u -S '#[fg=white]#{session_name}#[fg=grey]: #{session_windows} windows #{?session_grouped, (group ,}#{session_group}#{?session_grouped,),}#{?session_attached, (attached),}' -W '#{window_index}: #{window_name}#{window_flags} \"#{pane_title}\"'
bind -n M-6 run "tmux new-window -c #{pane_current_path}"
bind -n M-7 run "tmux split-window -h -c #{pane_current_path}"
bind -n M-8 run "tmux split-window -vp 45 -c #{pane_current_path}"
bind -n M-9 choose-tree -w
bind -n M-0 choose-tree -s
# TODO: The following mapping does not work anymore
# bind -n M-0 choose-tree -s -S '#{session_name}: #{session_windows} windows #{?session_grouped, (group ,}#{session_group}#{?session_grouped,),}#{?session_attached, (attached),}' -W '#{window_index}: #{window_name}#{window_flags} \"#{pane_title}\"'

set -g default-terminal "screen-256color"

# Enable activity alerts
setw -g monitor-activity off
set -g visual-activity off

# default statusbar colors
set-option -g status-bg colour235 #base02
set-option -g status-fg colour136 #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg colour244 #base0
set-window-option -g window-status-bg default
set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg colour166 #orange
set-window-option -g window-status-current-bg default
set-window-option -g window-status-current-attr bright
set-window-option -g window-status-separator "|"

# pane border
set-option -g pane-border-fg yellow #base02
set-option -g pane-active-border-fg red 

# message text
set-option -g message-bg colour235 #base02
set-option -g message-fg colour166 #orange

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green
